<!DOCTYPE html> <meta charset=utf-8  /> <meta name=viewport  content="width=device-width, initial-scale=1.0" /> <meta name=viewport  content="width=device-width,initial-scale=1"> <meta http-equiv=x-ua-compatible  content="ie=edge"> <meta name="lang:clipboard.copy" content="Copy to clipboard"> <meta name="lang:clipboard.copied" content="Copied to clipboard"> <meta name="lang:search.language" content=en > <meta name="lang:search.pipeline.stopwords" content=True > <meta name="lang:search.pipeline.trimmer" content=True > <meta name="lang:search.result.none" content="No matching documents"> <meta name="lang:search.result.one" content="1 matching document"> <meta name="lang:search.result.other" content="# matching documents"> <meta name="lang:search.tokenizer" content="[\s\-]+"> <link href="https://fonts.gstatic.com/" rel=preconnect  crossorigin> <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel=stylesheet > <style> body, input { font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif } code, kbd, pre { font-family: "Roboto Mono", "Courier New", Courier, monospace } </style> <link rel=stylesheet  href="../_static/stylesheets/application.css"/> <link rel=stylesheet  href="../_static/stylesheets/application-palette.css"/> <link rel=stylesheet  href="../_static/stylesheets/application-fixes.css"/> <link rel=stylesheet  href="../_static/fonts/material-icons.css"/> <meta name=theme-color  content="#2196f3"> <script src="../_static/javascripts/modernizr.js"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-XX133829453-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'UA-XX133829453-1'); </script> <title>Machine Learning with Scikit-Learn &#8212; Practical Data Science</title> <link rel=stylesheet  type="text/css" href="../_static/pygments.css" /> <link rel=stylesheet  type="text/css" href="../_static/material.css" /> <script data-url_root="../" id=documentation_options  src="../_static/documentation_options.js"></script> <script src="../_static/jquery.js"></script> <script src="../_static/underscore.js"></script> <script src="../_static/doctools.js"></script> <script crossorigin=anonymous  integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script> <script async=async  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script> <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script> <link rel="shortcut icon" href="../_static/mids_logo.svg"/> <link rel=index  title=Index  href="../genindex.html" /> <link rel=search  title=Search  href="../search.html" /> <body dir=ltr data-md-color-primary=blue-grey data-md-color-accent=blue> <svg class=md-svg > <defs data-children-count=0 > <svg xmlns="http://www.w3.org/2000/svg" width=416  height=448  viewBox="0 0 416 448" id=__github ><path fill=currentColor  d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg> </defs> </svg> <input class=md-toggle  data-md-toggle=drawer  type=checkbox  id=__drawer > <input class=md-toggle  data-md-toggle=search  type=checkbox  id=__search > <label class=md-overlay  data-md-component=overlay  for=__drawer ></label> <a href="#exercises/Exercise_scikit_learn" tabindex=1  class=md-skip > Skip to content </a> <header class=md-header  data-md-component=header > <nav class="md-header-nav md-grid"> <div class="md-flex navheader"> <div class="md-flex__cell md-flex__cell--shrink"> <a href="../index.html" title="Practical Data Science" class="md-header-nav__button md-logo"> <img src="../_static/mids_logo.svg" height=26  alt="Practical Data Science logo"> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer ></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title > <span class=md-header-nav__topic >Practical Data Science</span> <span class=md-header-nav__topic > Machine Learning with Scikit-Learn </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search ></label> <div class=md-search  data-md-component=search  role=dialog > <label class=md-search__overlay  for=__search ></label> <div class=md-search__inner  role=search > <form class=md-search__form  action="../search.html" method=get  name=search > <input type=text  class=md-search__input  name=q  placeholder=Search  autocapitalize=off  autocomplete=off  spellcheck=false  data-md-component=query  data-md-state=active > <label class="md-icon md-search__icon" for=__search ></label> <button type=reset  class="md-icon md-search__icon" data-md-component=reset  tabindex=-1 > &#xE5CD; </button> </form> <div class=md-search__output > <div class=md-search__scrollwrap  data-md-scrollfix> <div class=md-search-result  data-md-component=result > <div class=md-search-result__meta > Type to start searching </div> <ol class=md-search-result__list ></ol> </div> </div> </div> </div> </div> </div> <script src="../_static/javascripts/version_dropdown.js"></script> <script> var json_loc = "../"versions.json"", target_loc = "../../", text = "Versions"; $( document ).ready( add_version_dropdown(json_loc, target_loc, text)); </script> </div> </nav> </header> <div class=md-container > <nav class=md-tabs  data-md-component=tabs > <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list > <li class=md-tabs__item ><a href="../index.html" class=md-tabs__link >Home</a> <li class=md-tabs__item ><a href="../class_schedule.html" class=md-tabs__link >Class Schedule</a> <li class=md-tabs__item ><a href="../topic_list.html" class=md-tabs__link >Topic List</a> <li class=md-tabs__item ><a href="https://www.nickeubank.com" class=md-tabs__link >About The Author</a> </ul> </div> </nav> <main class=md-main > <div class="md-main__inner md-grid" data-md-component=container > <div class="md-sidebar md-sidebar--primary" data-md-component=navigation > <div class=md-sidebar__scrollwrap > <div class=md-sidebar__inner > <nav class="md-nav md-nav--primary" data-md-level=0 > <label class="md-nav__title md-nav__title--site" for=__drawer > <a href="../index.html" title="Practical Data Science" class="md-nav__button md-logo"> <img src="../_static/mids_logo.svg" alt=" logo" width=48  height=48 > </a> <a href="../index.html" title="Practical Data Science">Practical Data Science</a> </label> <ul class=md-nav__list > <li class=md-nav__item > <a href="../class_schedule.html" class=md-nav__link >Class Schedule</a> <li class=md-nav__item > <a href="../topic_list.html" class=md-nav__link >Topic List</a> <li class=md-nav__item > <span class="md-nav__link caption"><span class=caption-text >Environment Setup</span></span> <li class=md-nav__item > <a href="../setting_up_your_computer.html" class=md-nav__link >Setup Computer for Data Science</a> <li class=md-nav__item > <a href="../vscode.html" class=md-nav__link >Using VS Code For Data Science</a> <li class=md-nav__item > <span class="md-nav__link caption"><span class=caption-text >Basic Tools</span></span> <li class=md-nav__item > <a href="../command_line_part1.html" class=md-nav__link >Command Line, Basics</a> <li class=md-nav__item > <a href="../command_line_part2.html" class=md-nav__link >Command Line, Advanced</a> <li class=md-nav__item > <a href="../jupyter.html" class=md-nav__link >Jupyter</a> <li class=md-nav__item > <span class="md-nav__link caption"><span class=caption-text >Python &amp; Pandas</span></span> <li class=md-nav__item > <a href="../python_v_r.html" class=md-nav__link >Python / R Differences</a> <li class=md-nav__item > <a href="../vars_v_objects.html" class=md-nav__link >Python: Vars v Objects</a> <li class=md-nav__item > <a href="../ints_and_floats.html" class=md-nav__link >Numbers in Computers</a> <li class=md-nav__item > <a href="../pandas_series.html" class=md-nav__link >Pandas 1: Series</a> <li class=md-nav__item > <a href="../pandas_dataframes.html" class=md-nav__link >Pandas 2: DataFrames</a> <li class=md-nav__item > <a href="../plotting_altair_part1.html" class=md-nav__link >Plotting, Basics</a> <li class=md-nav__item > <a href="../plotting_altair_part2.html" class=md-nav__link >Plotting, Advanced</a> <li class=md-nav__item > <a href="../views_and_copies_in_pandas.html" class=md-nav__link >Pandas 3: Views</a> <li class=md-nav__item > <a href="../parquet.html" class=md-nav__link >Parquet Format</a> <li class=md-nav__item > <span class="md-nav__link caption"><span class=caption-text >DS Concepts</span></span> <li class=md-nav__item > <a href="../defensive_programming.html" class=md-nav__link >Defensive Programming</a> <li class=md-nav__item > <a href="../workflow.html" class=md-nav__link >Workflow Management</a> <li class=md-nav__item > <a href="../backwards_design.html" class=md-nav__link >Backwards Design</a> <li class=md-nav__item > <a href="../getting_help.html" class=md-nav__link >Getting Help Online</a> <li class=md-nav__item > <a href="../what_is_big_data.html" class=md-nav__link >What is Big Data?</a> <li class=md-nav__item > <a href="../big_data_strategies.html" class=md-nav__link >Working with Big Data</a> <li class=md-nav__item > <a href="../performance_understanding.html" class=md-nav__link >Understanding Performance</a> <li class=md-nav__item > <a href="../performance_solutions.html" class=md-nav__link >Solving Performance Probs</a> <li class=md-nav__item > <a href="../parallelism.html" class=md-nav__link >Parallel Computing</a> <li class=md-nav__item > <a href="../distributed_computing.html" class=md-nav__link >Distributed Computing</a> <li class=md-nav__item > <span class="md-nav__link caption"><span class=caption-text >Git and Github</span></span> <li class=md-nav__item > <a href="../git_and_github.html" class=md-nav__link >Git and Github</a> <li class=md-nav__item > <a href="../pr_review.html" class=md-nav__link >Reviewing Code on Github</a> <li class=md-nav__item > <span class="md-nav__link caption"><span class=caption-text >GIS</span></span> <li class=md-nav__item > <a href="../gis_what_is_gis.html" class=md-nav__link >What is GIS?</a> <li class=md-nav__item > <a href="../gis_setup_geopandas.html" class=md-nav__link >Installing Geopandas</a> <li class=md-nav__item > <a href="../gis_geopandas.html" class=md-nav__link >Geopandas</a> <li class=md-nav__item > <a href="../gis_spatial_joins.html" class=md-nav__link >Merging Spatial Data</a> <li class=md-nav__item > <a href="../gis_data.html" class=md-nav__link >Spatial Data Formats</a> <li class=md-nav__item > <a href="../gis_projections.html" class=md-nav__link >Spatial Projections</a> <li class=md-nav__item > <a href="../gis_crs_geopandas.html" class=md-nav__link >Managing Projections in Geopandas</a> <li class=md-nav__item > <a href="../gis_mapping.html" class=md-nav__link >Mapping with Geopandas</a> <li class=md-nav__item > <span class="md-nav__link caption"><span class=caption-text >Other</span></span> <li class=md-nav__item > <a href="../buying_datascience_computer.html" class=md-nav__link >Buying a Data Science Computer</a> <li class=md-nav__item > <a href="../not_a_mids_student.html" class=md-nav__link >Not a MIDS Student?</a> <li class=md-nav__item > <a href="../cheatsheets.html" class=md-nav__link >Cheat Sheets</a> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc > <div class=md-sidebar__scrollwrap > <div class=md-sidebar__inner > <nav class="md-nav md-nav--secondary"> <label class=md-nav__title  for=__toc >Contents</label> <ul class=md-nav__list  data-md-scrollfix=""> <li class=md-nav__item ><a href="#exercises-exercise-scikit-learn--page-root" class=md-nav__link >Machine Learning with Scikit-Learn</a><nav class=md-nav > <ul class=md-nav__list > <li class=md-nav__item ><a href="#Formatting-Your-Data" class=md-nav__link >Formatting Your Data</a> <li class=md-nav__item ><a href="#Splitting-Your-Data" class=md-nav__link >Splitting Your Data</a> <li class=md-nav__item ><a href="#Training-your-Model" class=md-nav__link >Training your Model</a> <li class=md-nav__item ><a href="#Evaluating-your-Model" class=md-nav__link >Evaluating your Model</a> <li class=md-nav__item ><a href="#Machine-Learning-Workflow-Summary" class=md-nav__link >Machine Learning Workflow Summary</a> <li class=md-nav__item ><a href="#Comparing-Models" class=md-nav__link >Comparing Models</a> <li class=md-nav__item ><a href="#Want-More-Practice?" class=md-nav__link >Want More Practice?</a> <li class=md-nav__item ><a href="#Absolutely-positively-need-the-solutions?" class=md-nav__link >Absolutely positively need the solutions?</a> </ul> </nav> </ul> </nav> </div> </div> </div> <div class=md-content > <article class="md-content__inner md-typeset" role=main > <h1 id=exercises-exercise-scikit-learn--page-root >Machine Learning with Scikit-Learn<a class=headerlink  href="#exercises-exercise-scikit-learn--page-root" title="Permalink to this headline">¶</a></h1> <p>In these exercises, we’ll learn to fit and evaluate (in a basic way) machine learning models using the package <code class="docutils literal notranslate"><span class=pre >scikit-learn</span></code>.</p> <p>The emphasis of these exercises is to help you get comfortable with the data wrangling component of machine learning so that in future courses you can focus on the <em>theory</em> underlying machine learning. With that in mind, we will be quite cavalier with model fitting and evaluation. As with our <code class="docutils literal notranslate"><span class=pre >statsmodels</span></code> exercises, in which we quickly ran through a few models to practice model <em>implemention</em> without thinking too much about model selection and specification, this is <strong>not</strong> how you should do your actual data science analyses!</p> <p>Though this is true generally, it is doubly true in the context of these exercises: the application of machine learning to medicine.</p> <p>In these exercises, we will use the birth-weight data we used for our <code class="docutils literal notranslate"><span class=pre >statsmodels</span></code> exercises to predict birth weights. As you will see, implementing a machine learning model to predict birth weights is actually surprisingly straight-forward. But that ease is deceptive, because while machine learning algorithms are easy to use, they’re hard to use <em>well</em>, and if you get them wrong in contexts where they impact real people, poorly implemented machine learning models can literally kill people.</p> <p>Lest you think I’m being hyperbolic, consider the case of a machine learning model used by medical providers across the US to make treatment decisions for millions of people. The goal of the model (distributed by a company called Optum) was to help providers figure out what patients were especially likely to face health problems down the road so they could provide these patients extra preventative care.</p> <p>The problem, though, is that the way Optum did this was by training a supervised machine learning model to predict future health care use by patients. Patients the model predicted would consume more healthcare in the future, the model implicitly assumed, were those who should get extra care today.</p> <p>But <a class="reference external" href="https://www.washingtonpost.com/health/2019/10/24/racial-bias-medical-algorithm-favors-white-patients-over-sicker-black-patients/">as was recently described in a paper in the journal Science</a>, the problem is that the model had a large racial bias, and was less likely to recommend extra preventative care for Black patients.</p> <p>The reason was that Black patients in the United States tend to use the medical system less than White patients <em>for non-medical reasons</em> (likely including skepticism towards the medical establishment due to the history of Black Americans being used as <a class="reference external" href="https://en.wikipedia.org/wiki/Tuskegee_syphilis_experiment">unknowing test subjects for medical studies</a>, or the fact that Black Americans tend to have lower incomes and are less likely to be insured than White Americans).</p> <p>But when this model saw that Black patients didn’t consume as much healthcare in the future, the algorithm interpreted that as evidence that Black patients were healthier (not poorer, or skeptical of the medical system). As a result, it became less likely to recommend future care for these patients.</p> <p><strong>Crucially, this occurred even though race wasn’t even a variable in the model.</strong> Machine learning models are very good at picking up subtle signals, and so even though patient race wasn’t an explicit factor in the model, the model was nevertheless able to differential Black and White patients. Though it’s not clear exactly how it did so, this can happen whenever variables are included in models that are <em>correlated</em> with race. For example, people’s zip codes (which identify where people live) are notorious for proxying for race in machine learning algorithms since residential segration in the US means that most people in a given zipcode are of the same race.</p> <p>And so as a result, this well-meaning machine learning algorithm resulted in black patients receiving fewer preventative medical interventions than white patients, even after taking into account other (medically relevant) factors.</p> <p>So: in this exercise we’ll play with predict birth weights in infants. But do <strong>NOT</strong> think that just because it’s this easy to fit a model, it is appropriate to then go use these in the real world in contexts where people’s lives are affected!</p> <p><strong>(1)</strong> Load the data “smoking.csv”, which includes information on both biometrics of infants at birth, and information on mothers (variables prefixed with the letter “m”), from <a class="reference external" href="https://github.com/nickeubank/MIDS_Data">this MIDS repo</a>. We’ll be working with this data in this exercise.</p> <h2 id=Formatting-Your-Data >Formatting Your Data<a class=headerlink  href="#Formatting-Your-Data" title="Permalink to this headline">¶</a></h2> <p>Unlike in <code class="docutils literal notranslate"><span class=pre >statsmodels</span></code>, we can’t use <code class="docutils literal notranslate"><span class=pre >pandas</span></code> DataFrames in scikit-learn, so the first step in nearly any machine learning workflow (if you haven’t already been given a nice giant numpy array) is to convert our heterogeneous pandas array (which includes strings, categorical variables, integers, and floating point numbers) into a single large matrix that consists only of floating point numbers.</p> <p>While you can do this by hand, this is most easily accomplished using the <code class="docutils literal notranslate"><span class=pre >Patsy</span></code> library, which will take a pandas array and a special formula string and return numpy arrays for use in libraries like scikit-learn. (<code class="docutils literal notranslate"><span class=pre >patsy</span></code> is actually the library that implemented the formulas we used in <code class="docutils literal notranslate"><span class=pre >statsmodels</span></code> to specify our regression models – here we’re just using it on its own).</p> <p>Let’s assume that for most of these exercises, we want to predict birth weight (<code class="docutils literal notranslate"><span class=pre >bwt.oz</span></code>) using:</p> <ul class=simple > <li><p>whether the mother is white, black, hispanic or of another ethnicity, (you have to code from <code class="docutils literal notranslate"><span class=pre >mrace</span></code> – make sure you treat this as categorical!).</p> <li><p>whether the mother smokes (<code class="docutils literal notranslate"><span class=pre >smoke</span></code>)</p> <li><p>Mother’s age (<code class="docutils literal notranslate"><span class=pre >mage</span></code>)</p> <li><p>Mother’s weight (<code class="docutils literal notranslate"><span class=pre >mpregwt</span></code>)</p> <li><p>Mother’s height (<code class="docutils literal notranslate"><span class=pre >mht</span></code>)</p> </ul> <p>For race, recall that in the raw data, <code class="docutils literal notranslate"><span class=pre >mrace</span></code> is coded as:</p> <div class="highlight-none notranslate"><div class=highlight ><pre><span></span>mrace    mother’s race or ethnicity
         0-5= white
         6  = mexican
         7 = black
         8 = asian
         9 = mix
         99 = unknown
</pre></div> </div> <p>(We’re ignoring <code class="docutils literal notranslate"><span class=pre >gestation</span></code> because we don’t really know the value of <code class="docutils literal notranslate"><span class=pre >gestation</span></code> before the child is born, so we can’t use it to predict the birthweight of not-yet-born children!)</p> <p><strong>(2)</strong> Begin by using <code class="docutils literal notranslate"><span class=pre >patsy.dmatrices()</span></code> to create two datasets (<code class="docutils literal notranslate"><span class=pre >y</span></code>, which is the birth weights, and <code class="docutils literal notranslate"><span class=pre >X</span></code>, which is a matrix with all your “features” in a nice numpy array).</p> <p><strong>(3)</strong> Look at your features matrix <code class="docutils literal notranslate"><span class=pre >X</span></code>. How many columns does it have? How does that compare to the number of variables you used as inputs? (if they’re the same, you probably did something wrong…). Can you explain the difference?</p> <p>If not <a class="reference external" href="https://hackernoon.com/what-is-one-hot-encoding-why-and-when-do-you-have-to-use-it-e3c6186d008f">read this (mostly on how this works in data)</a> and/or <a class="reference external" href="https://www.unifyingdatascience.org/html/interpreting_indicator_vars.html">this (on interpretation of indicator variables)</a>. This is one of the very nice things that <code class="docutils literal notranslate"><span class=pre >patsy</span></code> does for us!</p> <h2 id=Splitting-Your-Data >Splitting Your Data<a class=headerlink  href="#Splitting-Your-Data" title="Permalink to this headline">¶</a></h2> <p>In machine learning, model selection is often accomplished by:</p> <ol class="arabic simple"> <li><p>Splitting your data into two parts (a training set and a test set),</p> <li><p>Training your model on the training set (i.e. set the parameters of your model to best explain the training data).</p> <li><p>Test the model by using the parameters generated during that training to predict values for the testing data, then comparing the predicted values for the testing data to the actual values in the test data.</p> </ol> <p>So suppose we just wanted to use linear regression as our model. We’d randomly pick half the rows of our data, then regress birth weight on the various variables (“features” in machine learning terminology) we specified above. Then we’d use the coefficients from that regression to predict birth weights for the half of children we didn’t use in our estimation, and see how different those predictions are from actual birth weights. If we find a model that performs well on our testing data, then we <em>assume</em> / <em>hope</em> that that model will also work well on new data (i.e. on children who haven’t been born yet whose weight we want to predict).</p> <p>(Readers from a statistics background will recognize this is a kind of “cross-validation”, though a very simple version.)</p> <p>So the first step in machine learning is to split our sample! Thankfully this is easy to do with the <code class="docutils literal notranslate"><span class=pre >train_test_split</span></code> function. So import it with <code class="docutils literal notranslate"><span class=pre >from</span> <span class=pre >sklearn.model_selection</span> <span class=pre >import</span> <span class=pre >train_test_split</span></code>, and split your data. To give you a sense of how it works, this is a common syntax:</p> <div class="highlight-python notranslate"><div class=highlight ><pre><span></span><span class=kn >from</span> <span class=nn >sklearn.model_selection</span> <span class=kn >import</span> <span class=n >train_test_split</span>

<span class=n >X_train</span><span class=p >,</span> <span class=n >X_test</span><span class=p >,</span> <span class=n >Y_train</span><span class=p >,</span> <span class=n >Y_test</span> <span class=o >=</span> <span class=n >train_test_split</span><span class=p >(</span><span class=n >X</span><span class=p >,</span> <span class=n >y</span><span class=p >,</span>
                                                    <span class=n >test_size</span><span class=o >=</span><span class=mf >0.3</span><span class=p >,</span>
                                                    <span class=n >train_size</span><span class=o >=</span><span class=mf >0.7</span><span class=p >,</span>
                                                    <span class=n >random_state</span><span class=o >=</span><span class=mi >42</span><span class=p >)</span>
</pre></div> </div> <p>Where <code class="docutils literal notranslate"><span class=pre >X_train</span></code> is your training features, <code class="docutils literal notranslate"><span class=pre >Y_train</span></code> are your training birth weights, <code class="docutils literal notranslate"><span class=pre >X_test</span></code> are your test features, and <code class="docutils literal notranslate"><span class=pre >Y_test</span></code> are your test birth weights. The <code class="docutils literal notranslate"><span class=pre >random_state</span></code> var just ensures that you can re-create this split if you have to re-run your code (helpful for debugging).</p> <p><strong>(4)</strong> So start by splitting YOUR data.</p> <h2 id=Training-your-Model >Training your Model<a class=headerlink  href="#Training-your-Model" title="Permalink to this headline">¶</a></h2> <p>And now it’s time to train our model!</p> <p><code class="docutils literal notranslate"><span class=pre >scikit-learn</span></code> is much loved because it has, like… every model ever already built in, and it provides a common interface (API) for all of them. Seriously – go check out all the supervised machine learning models that come <a class="reference external" href="https://scikit-learn.org/stable/supervised_learning.html#supervised-learning">with scikit-learn here</a>.</p> <p>Moreover, unlike many open-source projects, all of its models are really well documented, so you can read all about them! And <a class="reference external" href="https://scikit-learn.org/stable/tutorial/machine_learning_map/index.html">check out this nifty guide to choosing an appropriate model</a>.</p> <p>For this exercise, let’s start by fitting a LinearRegression model.</p> <p>Wait, you say: isn’t that what we did in <code class="docutils literal notranslate"><span class=pre >statsmodels</span></code>? Yes!</p> <p>Data Science is a very fragmented little world, and some stuff gets recapitulated in slightly different wants in many different places, so it’s common to see different presentations of the same thing as you move from the world of statisticians to the world of computer scientists (i.e. machine learning).</p> <p><strong>(5)</strong> Import the Linear Regression model and instantiate it with code like:</p> <div class="highlight-python notranslate"><div class=highlight ><pre><span></span><span class=kn >from</span> <span class=nn >sklearn.linear_model</span> <span class=kn >import</span> <span class=n >LinearRegression</span>
<span class=n >my_model</span> <span class=o >=</span> <span class=n >LinearRegression</span><span class=p >()</span>
</pre></div> </div> <p><strong>(6)</strong> Now fit your model against X and y. (If you’re unsure how to do this, read the docs for the model and look at the examples at the bottom!</p> <p><strong>Note:</strong> In <code class="docutils literal notranslate"><span class=pre >statsmodels</span></code>, the <code class="docutils literal notranslate"><span class=pre >.fit()</span></code> method returned a new fitted model. In <code class="docutils literal notranslate"><span class=pre >sklearn</span></code>, by contrast, <code class="docutils literal notranslate"><span class=pre >.fit</span></code> modifies (mutates) the model in place.</p> <p>Machine learning, more than absolutely anything else, is concerned with predicting values, and that’s evident in what functionality is exposed by this linear model. As you may recall, in <code class="docutils literal notranslate"><span class=pre >statsmodels</span></code>, you could type <code class="docutils literal notranslate"><span class=pre >.summary()</span></code> and get something that looked like this:</p> <img alt=statsmodel_output  src="../_images/statsmodel_output.png"/> <p>A full printout of various dignostics, all your coefficients, estimates of confidence intervals for each coefficient, etc. etc. By contrast, <code class="docutils literal notranslate"><span class=pre >LinearRegression</span></code> from <code class="docutils literal notranslate"><span class=pre >sklearn</span></code> has no <code class="docutils literal notranslate"><span class=pre >summary</span></code> method. Indeed, the only output you really get for what the model has actually fit is <code class="docutils literal notranslate"><span class=pre >my_model.coef_</span></code>, which looks like:</p> <div class="highlight-python notranslate"><div class=highlight ><pre><span></span><span class=o >&gt;</span> <span class=n >my_model</span><span class=o >.</span><span class=n >fit</span><span class=p >(</span><span class=n >X_train</span><span class=p >,</span> <span class=n >y_train</span><span class=p >)</span>
<span class=o >&gt;</span> <span class=n >my_model</span><span class=o >.</span><span class=n >coef_</span>

<span class=n >array</span><span class=p >([[</span> <span class=mf >0.00000000e+00</span><span class=p >,</span>  <span class=mf >4.88967789e+00</span><span class=p >,</span> <span class=o >-</span><span class=mf >9.57549359e+00</span><span class=p >,</span>
        <span class=o >-</span><span class=mf >7.78152768e+00</span><span class=p >,</span> <span class=o >-</span><span class=mf >8.15196740e+00</span><span class=p >,</span>  <span class=mf >8.70134871e-03</span><span class=p >,</span>
         <span class=mf >1.31058392e-01</span><span class=p >,</span>  <span class=mf >1.01948361e+00</span><span class=p >]])</span>
</pre></div> </div> <p>Which I think we can all agree is not nearly as informative a print-out!</p> <p>To be clear, you can recover many of the diagnostics for LinearRegression by digging around in other corners of <code class="docutils literal notranslate"><span class=pre >sklearn</span></code>, but what is made available speaks to the prioritizes of different users: <code class="docutils literal notranslate"><span class=pre >sklearn</span></code> is for making predictions; <code class="docutils literal notranslate"><span class=pre >statsmodels</span></code> is for statistics and understanding mechanisms (i.e. seeing if the coefficient on smoking is significant).</p> <p><strong>(7)</strong> OK, but we’re in the world of sklearn, so let’s do some prediction! Now that you’ve fit your model, use the <code class="docutils literal notranslate"><span class=pre >predict</span></code> method your data to create a set of predictions.</p> <h2 id=Evaluating-your-Model >Evaluating your Model<a class=headerlink  href="#Evaluating-your-Model" title="Permalink to this headline">¶</a></h2> <p>So we now have a trained model that we can use to predict birthweights. Yay! But is it any good?</p> <p>All <code class="docutils literal notranslate"><span class=pre >sklearn</span></code> models have a method called <code class="docutils literal notranslate"><span class=pre >score</span></code> you can used to get the most basic evaluation of your model. The syntax is just:</p> <div class="highlight-python notranslate"><div class=highlight ><pre><span></span><span class=n >my_model</span><span class=o >.</span><span class=n >score</span><span class=p >(</span><span class=n >X_test</span><span class=p >,</span> <span class=n >y_test</span><span class=p >)</span>
</pre></div> </div> <p>If you’re doing a classification model (something that tries to guess the category for each observation, like a model that evalutes a set of pictures and tries to figure out if the pictures are of cats, dogs, or humans), <code class="docutils literal notranslate"><span class=pre >score</span></code> will return an “accuracy” score (the percentage of observations you properly classified). For a regression model (trying to guess a continuous variable) it will give an R-squared score.</p> <p>As you get more sophisticated, you will discover these basic scores are often inadequate for evaluating models, and you can turn to other evaluation functions found in <a class="reference external" href="https://scikit-learn.org/stable/modules/model_evaluation.html#scoring-parameter">sklearn.metrics</a>. But for now we’ll just use the default <code class="docutils literal notranslate"><span class=pre >score</span></code> output of R-squared.</p> <p><strong>(8)</strong> What is the score of your model?</p> <h2 id=Machine-Learning-Workflow-Summary >Machine Learning Workflow Summary<a class=headerlink  href="#Machine-Learning-Workflow-Summary" title="Permalink to this headline">¶</a></h2> <p>Congratulations! You just did you just fit your machine learning algorithm! And you also learned that sometimes what constitutes “machine learning” is in the eye of the beholder, given what you did today is the same thing you did in our last class without calling it machine learning. :)</p> <p>But hopefully that’s given you a general sense for the work-flow of scikit-learn:</p> <ol class="arabic simple"> <li><p>Prep your data:</p> </ol> <div class="highlight-python notranslate"><div class=highlight ><pre><span></span><span class=kn >import</span> <span class=nn >patsy</span>
<span class=n >y</span> <span class=p >,</span> <span class=n >X</span> <span class=o >=</span> <span class=n >patsy</span><span class=o >.</span><span class=n >dmatrices</span><span class=p >(</span><span class=s1 >'bwt_oz ~ C(race_recoded) + smoke + gestation + mage + mpregwt + mht'</span><span class=p >,</span> <span class=n >smoking_and_bw</span><span class=p >)</span>
</pre></div> </div> <ol class="arabic simple" start=2 > <li><p>Split your data:</p> </ol> <div class="highlight-python notranslate"><div class=highlight ><pre><span></span><span class=kn >from</span> <span class=nn >sklearn.model_selection</span> <span class=kn >import</span> <span class=n >train_test_split</span>

<span class=n >X_train</span><span class=p >,</span> <span class=n >X_test</span><span class=p >,</span> <span class=n >Y_train</span><span class=p >,</span> <span class=n >Y_test</span> <span class=o >=</span> <span class=n >train_test_split</span><span class=p >(</span><span class=n >X</span><span class=p >,</span> <span class=n >y</span><span class=p >,</span>
                                                    <span class=n >test_size</span><span class=o >=</span><span class=mf >0.5</span><span class=p >,</span>
                                                    <span class=n >train_size</span><span class=o >=</span><span class=mf >0.5</span><span class=p >,</span>
                                                    <span class=n >random_state</span><span class=o >=</span><span class=mi >42</span><span class=p >)</span>
</pre></div> </div> <ol class="arabic simple" start=3 > <li><p>Import and fit a model:</p> </ol> <div class="highlight-python notranslate"><div class=highlight ><pre><span></span><span class=kn >from</span> <span class=nn >sklearn.linear_model</span> <span class=kn >import</span> <span class=n >LinearRegression</span>
<span class=n >my_model</span> <span class=o >=</span> <span class=n >LinearRegression</span><span class=p >()</span>
<span class=n >my_model</span><span class=o >.</span><span class=n >fit</span><span class=p >(</span><span class=n >X_train</span><span class=p >,</span> <span class=n >y_train</span><span class=p >)</span>
</pre></div> </div> <ol class="arabic simple" start=4 > <li><p>Evaluate your model:</p> </ol> <div class="highlight-python notranslate"><div class=highlight ><pre><span></span><span class=n >my_model</span><span class=o >.</span><span class=n >score</span><span class=p >(</span><span class=n >X_test</span><span class=p >,</span> <span class=n >y_test</span><span class=p >)</span>
</pre></div> </div> <ol class="arabic simple" start=5 > <li><p>Use youre model to make predictions:</p> </ol> <div class="highlight-python notranslate"><div class=highlight ><pre><span></span><span class=n >my_predictions</span> <span class=o >=</span> <span class=n >my_model</span><span class=o >.</span><span class=n >predict</span><span class=p >(</span><span class=n >X_test</span><span class=p >)</span>
</pre></div> </div> <h2 id=Comparing-Models >Comparing Models<a class=headerlink  href="#Comparing-Models" title="Permalink to this headline">¶</a></h2> <p>Now that we have a baseline estimate for the performance of <code class="docutils literal notranslate"><span class=pre >LinearRegression</span></code> for this set of features and outputs, let’s try a different model and see how it compares!</p> <p><strong>(9)</strong> Now repeat your analysis using a Support Vector Regression (<code class="docutils literal notranslate"><span class=pre >from</span> <span class=pre >sklearn.svm</span> <span class=pre >import</span> <span class=pre >SVR</span></code>). How does the model perform? Is it better or worse than LinearRegression?</p> <p><strong>(10)</strong> One choice parameter for SVRs is the kernel it uses for weighting (again, this isn’t a class on machine learning, so don’t worry too much about what this means – just know that it’s a parameter of the model). Check the SVR documentation to figure out how to set the kernel to <code class="docutils literal notranslate"><span class=pre >linear</span></code> and see how it performs now.</p> <p><strong>(11)</strong> Now pick whatever regression model you’d like and see how it performs (<a class="reference external" href="https://scikit-learn.org/stable/tutorial/machine_learning_map/index.html">some suggestions</a>). Play with your model specifications and see how well you can do with your new model of one of the ones we used above.</p> <h2 id="Want-More-Practice?">Want More Practice?<a class=headerlink  href="#Want-More-Practice?" title="Permalink to this headline">¶</a></h2> <p>Try replicating our attempts to predict whether infants would be born premature from the <a class="reference internal" href=Exercise_statsmodels.html ><span class=doc >statsmodels exercises</span></a> in scikit-learn. Start with a LogisticRegression, then try some different “classification models” for comparison!</p> <h2 id="Absolutely-positively-need-the-solutions?">Absolutely positively need the solutions?<a class=headerlink  href="#Absolutely-positively-need-the-solutions?" title="Permalink to this headline">¶</a></h2> <p><em>Don’t use this link until you’ve really, really spent time struggling with your code!</em> Doing so only results in you cheating yourself.</p> <p><a class="reference internal" href="../solutions_warning.html"><span class=doc >Link</span></a></p> </article> </div> </div> </main> </div> <footer class=md-footer > <div class=md-footer-nav > <nav class="md-footer-nav__inner md-grid"> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright > <div class=md-footer-copyright__highlight > &#169; Copyright 2021, Nick Eubank. </div> Created using <a href="http://www.sphinx-doc.org/">Sphinx</a> 4.1.2. and <a href="https://github.com/bashtage/sphinx-material/">Material for Sphinx</a> </div> </div> </div> </footer> <script src="../_static/javascripts/application.js"></script> <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>