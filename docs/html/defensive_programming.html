<!DOCTYPE html> <meta charset=utf-8  /> <meta name=viewport  content="width=device-width, initial-scale=1.0" /><meta name=generator  content="Docutils 0.17.1: http://docutils.sourceforge.net/" /> <meta name=viewport  content="width=device-width,initial-scale=1"> <meta http-equiv=x-ua-compatible  content="ie=edge"> <meta name="lang:clipboard.copy" content="Copy to clipboard"> <meta name="lang:clipboard.copied" content="Copied to clipboard"> <meta name="lang:search.language" content=en > <meta name="lang:search.pipeline.stopwords" content=True > <meta name="lang:search.pipeline.trimmer" content=True > <meta name="lang:search.result.none" content="No matching documents"> <meta name="lang:search.result.one" content="1 matching document"> <meta name="lang:search.result.other" content="# matching documents"> <meta name="lang:search.tokenizer" content="[\s\-]+"> <link href="https://fonts.gstatic.com/" rel=preconnect  crossorigin> <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel=stylesheet > <style> body, input { font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif } code, kbd, pre { font-family: "Roboto Mono", "Courier New", Courier, monospace } </style> <link rel=stylesheet  href="_static/stylesheets/application.css"/> <link rel=stylesheet  href="_static/stylesheets/application-palette.css"/> <link rel=stylesheet  href="_static/stylesheets/application-fixes.css"/> <link rel=stylesheet  href="_static/fonts/material-icons.css"/> <meta name=theme-color  content="#2196f3"> <script src="_static/javascripts/modernizr.js"></script> <script> window.ga = window.ga || function () { (ga.q = ga.q || []).push(arguments) }; ga.l = +new Date; ga('create', 'UA-XX133829453-1', 'auto'); ga('send', 'pageview'); </script> <script async src='https://www.google-analytics.com/analytics.js'></script> <title>Defensive Programming &#8212; Practical Data Science</title> <link rel=stylesheet  type="text/css" href="_static/pygments.css" /> <link rel=stylesheet  type="text/css" href="_static/material.css" /> <script data-url_root="./" id=documentation_options  src="_static/documentation_options.js"></script> <script src="_static/jquery.js"></script> <script src="_static/underscore.js"></script> <script src="_static/doctools.js"></script> <script crossorigin=anonymous  integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script> <script async=async  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script> <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "document", "processHtmlClass": "math|output_area"}}</script> <link rel="shortcut icon" href="_static/mids_logo.svg"/> <link rel=index  title=Index  href=genindex.html  /> <link rel=search  title=Search  href=search.html  /> <link rel=next  title="Workflow Management" href=workflow.html  /> <link rel=prev  title=Parquet  href=parquet.html  /> <body dir=ltr data-md-color-primary=blue-grey data-md-color-accent=blue> <svg class=md-svg > <defs data-children-count=0 > <svg xmlns="http://www.w3.org/2000/svg" width=416  height=448  viewBox="0 0 416 448" id=__github ><path fill=currentColor  d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg> </defs> </svg> <input class=md-toggle  data-md-toggle=drawer  type=checkbox  id=__drawer > <input class=md-toggle  data-md-toggle=search  type=checkbox  id=__search > <label class=md-overlay  data-md-component=overlay  for=__drawer ></label> <a href="#defensive_programming" tabindex=1  class=md-skip > Skip to content </a> <header class=md-header  data-md-component=header > <nav class="md-header-nav md-grid"> <div class="md-flex navheader"> <div class="md-flex__cell md-flex__cell--shrink"> <a href=index.html  title="Practical Data Science" class="md-header-nav__button md-logo"> <img src="_static/mids_logo.svg" height=26  alt="Practical Data Science logo"> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer ></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title > <span class=md-header-nav__topic >Practical Data Science</span> <span class=md-header-nav__topic > Defensive Programming </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search ></label> <div class=md-search  data-md-component=search  role=dialog > <label class=md-search__overlay  for=__search ></label> <div class=md-search__inner  role=search > <form class=md-search__form  action=search.html  method=GET  name=search > <input type=text  class=md-search__input  name=q  placeholder=Search  autocapitalize=off  autocomplete=off  spellcheck=false  data-md-component=query  data-md-state=active > <label class="md-icon md-search__icon" for=__search ></label> <button type=reset  class="md-icon md-search__icon" data-md-component=reset  tabindex=-1 > &#xE5CD; </button> </form> <div class=md-search__output > <div class=md-search__scrollwrap  data-md-scrollfix> <div class=md-search-result  data-md-component=result > <div class=md-search-result__meta > Type to start searching </div> <ol class=md-search-result__list ></ol> </div> </div> </div> </div> </div> </div> <script src="_static/javascripts/version_dropdown.js"></script> <script> var json_loc = ""versions.json"", target_loc = "../", text = "Versions"; $( document ).ready( add_version_dropdown(json_loc, target_loc, text)); </script> </div> </nav> </header> <div class=md-container > <nav class=md-tabs  data-md-component=tabs > <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list > <li class=md-tabs__item ><a href=index.html  class=md-tabs__link >Home</a> <li class=md-tabs__item ><a href=class_schedule.html  class=md-tabs__link >Class Schedule</a> <li class=md-tabs__item ><a href=topic_list.html  class=md-tabs__link >Topic List</a> <li class=md-tabs__item ><a href="https://www.nickeubank.com" class=md-tabs__link >About The Author</a> </ul> </div> </nav> <main class=md-main > <div class="md-main__inner md-grid" data-md-component=container > <div class="md-sidebar md-sidebar--primary" data-md-component=navigation > <div class=md-sidebar__scrollwrap > <div class=md-sidebar__inner > <nav class="md-nav md-nav--primary" data-md-level=0 > <label class="md-nav__title md-nav__title--site" for=__drawer > <a href=index.html  title="Practical Data Science" class="md-nav__button md-logo"> <img src="_static/mids_logo.svg" alt=" logo" width=48  height=48 > </a> <a href=index.html  title="Practical Data Science">Practical Data Science</a> </label> <ul class=md-nav__list > <li class=md-nav__item > <a href=class_schedule.html  class=md-nav__link >Class Schedule</a> <li class=md-nav__item > <a href=topic_list.html  class=md-nav__link >Topic List</a> <li class=md-nav__item > <span class="md-nav__link caption"><span class=caption-text >Environment Setup</span></span> <li class=md-nav__item > <a href=setting_up_your_computer.html  class=md-nav__link >Setup Computer for Data Science</a> <li class=md-nav__item > <span class="md-nav__link caption"><span class=caption-text >Basic Tools</span></span> <li class=md-nav__item > <a href=command_line_part1.html  class=md-nav__link >Command Line, Basics</a> <li class=md-nav__item > <a href=command_line_part2.html  class=md-nav__link >Command Line, Advanced</a> <li class=md-nav__item > <a href=jupyter.html  class=md-nav__link >Jupyter</a> <li class=md-nav__item > <span class="md-nav__link caption"><span class=caption-text >Python &amp; Pandas</span></span> <li class=md-nav__item > <a href=python_v_r.html  class=md-nav__link >Python / R Differences</a> <li class=md-nav__item > <a href=vars_v_objects.html  class=md-nav__link >Python: Vars v Objects</a> <li class=md-nav__item > <a href=ints_and_floats.html  class=md-nav__link >Numbers in Computers</a> <li class=md-nav__item > <a href=pandas_series.html  class=md-nav__link >Pandas 1: Series</a> <li class=md-nav__item > <a href=pandas_dataframes.html  class=md-nav__link >Pandas 2: DataFrames</a> <li class=md-nav__item > <a href=plotting_part1.html  class=md-nav__link >Plotting, Basics</a> <li class=md-nav__item > <a href=plotting_part2.html  class=md-nav__link >Plotting, Advanced</a> <li class=md-nav__item > <a href=views_and_copies_in_pandas.html  class=md-nav__link >Pandas 3: Views</a> <li class=md-nav__item > <a href=cleaning_editingvalues.html  class=md-nav__link >Cleaning: Editing Values</a> <li class=md-nav__item > <a href=parquet.html  class=md-nav__link >Parquet Format</a> <li class=md-nav__item > <span class="md-nav__link caption"><span class=caption-text >DS Concepts</span></span> <li class=md-nav__item > <input class="md-toggle md-nav__toggle" data-md-toggle=toc  type=checkbox  id=__toc > <label class="md-nav__link md-nav__link--active" for=__toc > Defensive Programming </label> <a href="#" class="md-nav__link md-nav__link--active">Defensive Programming</a> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title  for=__toc >Contents</label> <ul class=md-nav__list  data-md-scrollfix=""> <li class=md-nav__item ><a href="#defensive-programming--page-root" class=md-nav__link >Defensive Programming</a><nav class=md-nav > <ul class=md-nav__list > <li class=md-nav__item ><a href="#Adding-Tests" class=md-nav__link >Adding Tests</a><nav class=md-nav > <ul class=md-nav__list > <li class=md-nav__item ><a href="#Writing-Tests" class=md-nav__link >Writing Tests</a> <li class=md-nav__item ><a href="#When-should-I-write-tests?" class=md-nav__link >When should I write tests?</a> </ul> </nav> <li class=md-nav__item ><a href="#Never-Transcribe" class=md-nav__link >Never Transcribe</a> <li class=md-nav__item ><a href="#Style-Matters" class=md-nav__link >Style Matters</a> <li class=md-nav__item ><a href="#Don’t-Duplicate-Information" class=md-nav__link >Don’t Duplicate Information</a> <li class=md-nav__item ><a href="#Collaboration" class=md-nav__link >Collaboration</a> <li class=md-nav__item ><a href="#When-Should-I-Write-Tests?" class=md-nav__link >When Should I Write Tests?</a><nav class=md-nav > <ul class=md-nav__list > <li class=md-nav__item ><a href="#Common-Test-Examples" class=md-nav__link >Common Test Examples</a> </ul> </nav> </ul> </nav> </ul> </nav> <li class=md-nav__item > <a href=workflow.html  class=md-nav__link >Workflow Management</a> <li class=md-nav__item > <a href=backwards_design.html  class=md-nav__link >Backwards Design</a> <li class=md-nav__item > <a href=getting_help.html  class=md-nav__link >Getting Help Online</a> <li class=md-nav__item > <a href=what_is_big_data.html  class=md-nav__link >What is Big Data?</a> <li class=md-nav__item > <a href=big_data_strategies.html  class=md-nav__link >Working with Big Data</a> <li class=md-nav__item > <a href=performance_understanding.html  class=md-nav__link >Understanding Performance</a> <li class=md-nav__item > <a href=performance_solutions.html  class=md-nav__link >Solving Performance Probs</a> <li class=md-nav__item > <a href=parallelism.html  class=md-nav__link >Parallel Computing</a> <li class=md-nav__item > <a href=distributed_computing.html  class=md-nav__link >Distributed Computing</a> <li class=md-nav__item > <span class="md-nav__link caption"><span class=caption-text >Git and Github</span></span> <li class=md-nav__item > <a href=git_and_github.html  class=md-nav__link >Git and Github</a> <li class=md-nav__item > <a href=pr_review.html  class=md-nav__link >Reviewing Code on Github</a> <li class=md-nav__item > <span class="md-nav__link caption"><span class=caption-text >Other</span></span> <li class=md-nav__item > <a href=buying_datascience_computer.html  class=md-nav__link >Buying a Data Science Computer</a> <li class=md-nav__item > <a href=not_a_mids_student.html  class=md-nav__link >Not a MIDS Student?</a> <li class=md-nav__item > <a href=cheatsheets.html  class=md-nav__link >Cheat Sheets</a> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc > <div class=md-sidebar__scrollwrap > <div class=md-sidebar__inner > <nav class="md-nav md-nav--secondary"> <label class=md-nav__title  for=__toc >Contents</label> <ul class=md-nav__list  data-md-scrollfix=""> <li class=md-nav__item ><a href="#defensive-programming--page-root" class=md-nav__link >Defensive Programming</a><nav class=md-nav > <ul class=md-nav__list > <li class=md-nav__item ><a href="#Adding-Tests" class=md-nav__link >Adding Tests</a><nav class=md-nav > <ul class=md-nav__list > <li class=md-nav__item ><a href="#Writing-Tests" class=md-nav__link >Writing Tests</a> <li class=md-nav__item ><a href="#When-should-I-write-tests?" class=md-nav__link >When should I write tests?</a> </ul> </nav> <li class=md-nav__item ><a href="#Never-Transcribe" class=md-nav__link >Never Transcribe</a> <li class=md-nav__item ><a href="#Style-Matters" class=md-nav__link >Style Matters</a> <li class=md-nav__item ><a href="#Don’t-Duplicate-Information" class=md-nav__link >Don’t Duplicate Information</a> <li class=md-nav__item ><a href="#Collaboration" class=md-nav__link >Collaboration</a> <li class=md-nav__item ><a href="#When-Should-I-Write-Tests?" class=md-nav__link >When Should I Write Tests?</a><nav class=md-nav > <ul class=md-nav__list > <li class=md-nav__item ><a href="#Common-Test-Examples" class=md-nav__link >Common Test Examples</a> </ul> </nav> </ul> </nav> </ul> </nav> </div> </div> </div> <div class=md-content > <article class="md-content__inner md-typeset" role=main > <style> /* CSS for nbsphinx extension */ /* remove conflicting styling from Sphinx themes */ div.nbinput.container div.prompt *, div.nboutput.container div.prompt *, div.nbinput.container div.input_area pre, div.nboutput.container div.output_area pre, div.nbinput.container div.input_area .highlight, div.nboutput.container div.output_area .highlight { border: none; padding: 0; margin: 0; box-shadow: none; } div.nbinput.container > div[class*=highlight], div.nboutput.container > div[class*=highlight] { margin: 0; } div.nbinput.container div.prompt *, div.nboutput.container div.prompt * { background: none; } div.nboutput.container div.output_area .highlight, div.nboutput.container div.output_area pre { background: unset; } div.nboutput.container div.output_area div.highlight { color: unset; /* override Pygments text color */ } /* avoid gaps between output lines */ div.nboutput.container div[class*=highlight] pre { line-height: normal; } /* input/output containers */ div.nbinput.container, div.nboutput.container { display: -webkit-flex; display: flex; align-items: flex-start; margin: 0; width: 100%; } @media (max-width: 540px) { div.nbinput.container, div.nboutput.container { flex-direction: column; } } /* input container */ div.nbinput.container { padding-top: 5px; } /* last container */ div.nblast.container { padding-bottom: 5px; } /* input prompt */ div.nbinput.container div.prompt pre { color: #307FC1; } /* output prompt */ div.nboutput.container div.prompt pre { color: #BF5B3D; } /* all prompts */ div.nbinput.container div.prompt, div.nboutput.container div.prompt { width: 4.5ex; padding-top: 5px; position: relative; user-select: none; } div.nbinput.container div.prompt > div, div.nboutput.container div.prompt > div { position: absolute; right: 0; margin-right: 0.3ex; } @media (max-width: 540px) { div.nbinput.container div.prompt, div.nboutput.container div.prompt { width: unset; text-align: left; padding: 0.4em; } div.nboutput.container div.prompt.empty { padding: 0; } div.nbinput.container div.prompt > div, div.nboutput.container div.prompt > div { position: unset; } } /* disable scrollbars on prompts */ div.nbinput.container div.prompt pre, div.nboutput.container div.prompt pre { overflow: hidden; } /* input/output area */ div.nbinput.container div.input_area, div.nboutput.container div.output_area { -webkit-flex: 1; flex: 1; overflow: auto; } @media (max-width: 540px) { div.nbinput.container div.input_area, div.nboutput.container div.output_area { width: 100%; } } /* input area */ div.nbinput.container div.input_area { border: 1px solid #e0e0e0; border-radius: 2px; /*background: #f5f5f5;*/ } /* override MathJax center alignment in output cells */ div.nboutput.container div[class*=MathJax] { text-align: left !important; } /* override sphinx.ext.imgmath center alignment in output cells */ div.nboutput.container div.math p { text-align: left; } /* standard error */ div.nboutput.container div.output_area.stderr { background: #fdd; } /* ANSI colors */ .ansi-black-fg { color: #3E424D; } .ansi-black-bg { background-color: #3E424D; } .ansi-black-intense-fg { color: #282C36; } .ansi-black-intense-bg { background-color: #282C36; } .ansi-red-fg { color: #E75C58; } .ansi-red-bg { background-color: #E75C58; } .ansi-red-intense-fg { color: #B22B31; } .ansi-red-intense-bg { background-color: #B22B31; } .ansi-green-fg { color: #00A250; } .ansi-green-bg { background-color: #00A250; } .ansi-green-intense-fg { color: #007427; } .ansi-green-intense-bg { background-color: #007427; } .ansi-yellow-fg { color: #DDB62B; } .ansi-yellow-bg { background-color: #DDB62B; } .ansi-yellow-intense-fg { color: #B27D12; } .ansi-yellow-intense-bg { background-color: #B27D12; } .ansi-blue-fg { color: #208FFB; } .ansi-blue-bg { background-color: #208FFB; } .ansi-blue-intense-fg { color: #0065CA; } .ansi-blue-intense-bg { background-color: #0065CA; } .ansi-magenta-fg { color: #D160C4; } .ansi-magenta-bg { background-color: #D160C4; } .ansi-magenta-intense-fg { color: #A03196; } .ansi-magenta-intense-bg { background-color: #A03196; } .ansi-cyan-fg { color: #60C6C8; } .ansi-cyan-bg { background-color: #60C6C8; } .ansi-cyan-intense-fg { color: #258F8F; } .ansi-cyan-intense-bg { background-color: #258F8F; } .ansi-white-fg { color: #C5C1B4; } .ansi-white-bg { background-color: #C5C1B4; } .ansi-white-intense-fg { color: #A1A6B2; } .ansi-white-intense-bg { background-color: #A1A6B2; } .ansi-default-inverse-fg { color: #FFFFFF; } .ansi-default-inverse-bg { background-color: #000000; } .ansi-bold { font-weight: bold; } .ansi-underline { text-decoration: underline; } div.nbinput.container div.input_area div[class*=highlight] > pre, div.nboutput.container div.output_area div[class*=highlight] > pre, div.nboutput.container div.output_area div[class*=highlight].math, div.nboutput.container div.output_area.rendered_html, div.nboutput.container div.output_area > div.output_javascript, div.nboutput.container div.output_area:not(.rendered_html) > img{ padding: 5px; margin: 0; } /* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */ div.nbinput.container div.input_area > div[class^='highlight'], div.nboutput.container div.output_area > div[class^='highlight']{ overflow-y: hidden; } /* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */ .prompt a.copybtn { display: none; } /* Some additional styling taken form the Jupyter notebook CSS */ div.rendered_html table { border: none; border-collapse: collapse; border-spacing: 0; color: black; font-size: 12px; table-layout: fixed; } div.rendered_html thead { border-bottom: 1px solid black; vertical-align: bottom; } div.rendered_html tr, div.rendered_html th, div.rendered_html td { text-align: right; vertical-align: middle; padding: 0.5em 0.5em; line-height: normal; white-space: normal; max-width: none; border: none; } div.rendered_html th { font-weight: bold; } div.rendered_html tbody tr:nth-child(odd) { background: #f5f5f5; } div.rendered_html tbody tr:hover { background: rgba(66, 165, 245, 0.2); } </style> <section id=Defensive-Programming > <h1 id=defensive-programming--page-root >Defensive Programming<a class=headerlink  href="#defensive-programming--page-root" title="Permalink to this headline">¶</a></h1> <p>In recent years, the social sciences have been struggling with a wave of papers that have turned out to have problems not because of problems of theory, or choice of statistical models, but rather because of simple programming errors. In perhaps the most embarassing, Steven Levitt (co-author of the acclaimed Freakonomics, and winner of one of the most prestigious awards in economics) had a paper about the political explosive (at least in the US) topic of abortion and crime that turned out to be wrong <a class="reference external" href="https://www.economist.com/finance-and-economics/2005/12/01/oops-onomics">because he hadn’t put a set of controls into a regression he thought he had (may require sign-in, though I think you can see without paying).</a> Moreover, as some of <a class="reference external" href="https://thepoliticalmethodologist.com/2014/12/09/a-decade-of-replications-lessons-from-the-quarterly-journal-of-political-science/">my own work has shown</a>, the replication packages that come with a substantial number of political science papers have problems, often generating results that do not match those in the published paper.</p> <p>In reading this, it’s natural to think that the reason we find problems in the code behind published papers is carelessness or inattention on behalf of authors, and that the key to minimizing problems in our code is to be more careful. The truth, I have come to believe, is more subtle: humans are effectively incapable of writing error-free code, and that if we wish to improve the quality of the code we write, we must start learning and teaching coding skills that help maximize the probability our mistakes will be found and corrected.</p> <p>I myself once firmly believed the fallacy that the key to preventing errors was “to be more careful.” Indeed, I fear this belief may have colored the tone of of my past work on this subject in unproductive ways. Over the last several years, however, my research has brought me into close contact with computer scientists, and I discovered that computer scientists’ mentality about programming is fundamentally different from the mental model I had been carrying around as a social scientist. Computer scientists <em>assume</em> programmers will make mistakes, and instead of chiding people to “just be careful,” they have developed a battery of practices to address the problem. These practices – often referred to as “defensive programming” skills – are designed to (a) minimize the probability mistakes occur and (b) maximize the probability that mistakes that do occur are caught.</p> <p>In this tutorial, we’ll cover a number of these defensive programming practices with an eye towards their application in the context of applied data science. I did not invent any of these practices, but you will likely find that the way I present them (and the use-cases I emphasize) will differ from most other presentations you will find online. That is because in this tutorial, I will focus on the type of applied data analysis common in the social sciences, natural science, or business analysis, rather than the type of “software engineering” applications where these methods are most commonly applied.</p> <section id=Adding-Tests > <h2 id=Adding-Tests >Adding Tests<a class=headerlink  href="#Adding-Tests" title="Permalink to this headline">¶</a></h2> <p>If we could only adopt one practice to improve the quality of our code, my vote would be for the addition of tests. Tests are simple true-false statements users place in their code. A test checks for a certain condition (like whether the sample size in a regression is what you expect), and if the condition is not met, stops your code and alerts you to the problem. Right now, many users may say “Yeah, I always check that kind of stuff by hand when I’m writing my code. Why do I need to add tests?” The answer is four-fold:</p> <ol class="arabic simple"> <li><p><strong>Tests are executed every time your code is run.</strong> Most of us check things the first time we write a piece of code. But days, weeks, or months later, we may come back, modify code the occurs earlier in our code stream, and then just re-run the code. If those changes lead to problems in later files, we don’t know about them. If you have tests in place, then those early changes will result in an error in the later files, and you can track down the problem.</p> <li><p><strong>It gets you in the habit of always checking.</strong> Most of us only stop to check aspects of our data when we suspect problems. But if you become accustomed to writing a handful of tests at the bottom of every file – or after ever execution of a certain operation (I’m trying to always including them after a merge), we get into the habit of <em>always</em> stopping to think about what our data should look like.</p> <li><p><strong>Catch your problems faster.</strong> This is less about code integrity than sanity, but a great upside to tests is that they ensure that if a mistake slips into your code, you become aware of it quickly, making it easier to identify and fix the changes that caused the problem.</p> <li><p><strong>Tests catch more than anticipated problems.</strong> When problems emerge in code, they often manifest in lots of different ways. Duplicate observations, for example, will not only lead to inaccurate observation counts, but may also give rise to bizarre summary statistics, bad subsequent merges, etc. Thus adding tests not only guards against errors we’ve thought of, but may also guard against errors we don’t anticipate during the test writing process.</p> </ol> <section id=Writing-Tests > <h3 id=Writing-Tests >Writing Tests<a class=headerlink  href="#Writing-Tests" title="Permalink to this headline">¶</a></h3> <p>Tests are easy to write in any language, but given this courses’ focus on Python, will discuss it here. For examples of tests in Stata and R, you can see <a class="reference external" href="http://www.nickeubank.com/replication">some resources I created towards the bottom of this site</a>.</p> <p>In Python, tests are written using the <code class="docutils literal notranslate"><span class=pre >assert</span></code> keyword:</p> <div class="nbinput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[1]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre>
<span></span><span class=n >x</span> <span class=o >=</span> <span class=mi >7</span>
<span class=n >y</span> <span class=o >=</span> <span class=mi >5</span>

<span class=c1 ># Make sure that x is greater than y</span>
<span class=k >assert</span> <span class=n >x</span> <span class=o >&gt;</span> <span class=n >y</span>
</pre></div> </div> </div> <div class="nbinput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[2]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre>
<span></span><span class=c1 ># Make sure that x is odd</span>
<span class=k >assert</span> <span class=n >x</span> <span class=o >%</span> <span class=mi >2</span> <span class=o >==</span> <span class=mi >1</span>
</pre></div> </div> </div> <p><code class="docutils literal notranslate"><span class=pre >assert</span></code> can also be used with vectors, though doing so requires one additional step. Since logical tests applied to vectors return vectors of Booleans, we have to specify how to evaluate that whole vector using <code class="docutils literal notranslate"><span class=pre >.any()</span></code> (returns <code class="docutils literal notranslate"><span class=pre >True</span></code> if any entries in the vector are <code class="docutils literal notranslate"><span class=pre >True</span></code>) and <code class="docutils literal notranslate"><span class=pre >all()</span></code> (only returns <code class="docutils literal notranslate"><span class=pre >True</span></code> if <em>all</em> the entries are <code class="docutils literal notranslate"><span class=pre >True</span></code>). For example:</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[3]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre>
<span></span><span class=c1 ># Load some country-level national statistics</span>
<span class=kn >import</span> <span class=nn >pandas</span> <span class=k >as</span> <span class=nn >pd</span>
<span class=n >world</span> <span class=o >=</span> <span class=n >pd</span><span class=o >.</span><span class=n >read_csv</span><span class=p >(</span><span class=s1 >'https://raw.githubusercontent.com/nickeubank/practicaldatascience/master/Example_Data/world-small.csv'</span><span class=p >)</span>
<span class=n >world</span><span class=o >.</span><span class=n >sample</span><span class=p >(</span><span class=mi >5</span><span class=p >)</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[3]:
</pre></div> </div> <div class="output_area rendered_html docutils container"> <div> <style scoped=""> .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } </style> <table border=1  class=dataframe > <thead> <tr style="text-align: right;"> <th> <th>country <th>region <th>gdppcap08 <th>polityIV <tr> <th>30 <td>Costa Rica <td>S. America <td>11241 <td>20.0 <tr> <th>118 <td>South Africa <td>Africa <td>10109 <td>19.0 <tr> <th>11 <td>Belgium <td>W. Europe <td>34493 <td>20.0 <tr> <th>140 <td>Venezuela <td>S. America <td>12804 <td>16.0 <tr> <th>53 <td>Guinea-Bissau <td>Africa <td>538 <td>11.0 </table> </div></div> </div> <div class="nbinput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[4]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre>
<span></span><span class=c1 ># Make sure everyone's GDP per capita estimates are positive:</span>
<span class=k >assert</span> <span class=p >(</span><span class=n >world</span><span class=p >[</span><span class=s1 >'gdppcap08'</span><span class=p >]</span> <span class=o >&gt;</span> <span class=mi >0</span><span class=p >)</span><span class=o >.</span><span class=n >all</span><span class=p >()</span>
</pre></div> </div> </div> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[5]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre>
<span></span><span class=c1 ># If you don't use `.all()` or `.any()`, you will get this error</span>
<span class=c1 ># saying "the truth value of a Series is ambiguous," meaning</span>
<span class=c1 ># "how do you want me to go from a vector of Trues and Falses to a single</span>
<span class=c1 ># True or False?"</span>

<span class=k >assert</span> <span class=n >world</span><span class=p >[</span><span class=s1 >'gdppcap08'</span><span class=p >]</span> <span class=o >&gt;</span> <span class=mi >0</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
<span class=ansi-red-fg >---------------------------------------------------------------------------</span>
<span class=ansi-red-fg >ValueError</span>                                Traceback (most recent call last)
<span class=ansi-green-fg >&lt;ipython-input-5-4d45f8c56a96&gt;</span> in <span class=ansi-cyan-fg >&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span> <span class=ansi-red-fg ># True or False?"</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span>
<span class=ansi-green-fg >----&gt; 6</span><span class=ansi-red-fg > </span><span class=ansi-green-fg >assert</span> world<span class=ansi-blue-fg >[</span><span class=ansi-blue-fg >'gdppcap08'</span><span class=ansi-blue-fg >]</span> <span class=ansi-blue-fg >&gt;</span> <span class=ansi-cyan-fg >0</span>

<span class=ansi-green-fg >~/miniconda3/lib/python3.7/site-packages/pandas/core/generic.py</span> in <span class=ansi-cyan-fg >__nonzero__</span><span class=ansi-blue-fg >(self)</span>
<span class="ansi-green-intense-fg ansi-bold">   1554</span>             <span class=ansi-blue-fg >"The truth value of a {0} is ambiguous. "</span>
<span class="ansi-green-intense-fg ansi-bold">   1555</span>             "Use a.empty, a.bool(), a.item(), a.any() or a.all().".format(
<span class=ansi-green-fg >-&gt; 1556</span><span class=ansi-red-fg >                 </span>self<span class=ansi-blue-fg >.</span>__class__<span class=ansi-blue-fg >.</span>__name__
<span class="ansi-green-intense-fg ansi-bold">   1557</span>             )
<span class="ansi-green-intense-fg ansi-bold">   1558</span>         )

<span class=ansi-red-fg >ValueError</span>: The truth value of a Series is ambiguous. Use a.empty, a.bool(), a.item(), a.any() or a.all().
</pre></div></div> </div> </section> <section id="When-should-I-write-tests?"> <h3 id="When-should-I-write-tests?">When should I write tests?<a class=headerlink  href="#When-should-I-write-tests?" title="Permalink to this headline">¶</a></h3> <p>Great question! More on that in the last section of this tutorial (let’s focus on principles before we get too far into specific implementation questions).</p> </section> </section> <section id=Never-Transcribe > <h2 id=Never-Transcribe >Never Transcribe<a class=headerlink  href="#Never-Transcribe" title="Permalink to this headline">¶</a></h2> <p>We’ve already covered tricks to maximize the probability we catch our mistakes, but how do we minimize the probability they will occur? If there is anything I learned working as the Replication Assistant at the <em>Quarterly Journal of Political Science</em> testing people’s replication packages, it is that authors should <strong>never</strong> transcribe numbers from their statistical software into their papers by hand. This was <em>easily</em> the largest source of replication issues we encountered, as doing so introduced two types of errors:</p> <ul class=simple > <li><p><strong>Mis-transcriptions:</strong> Humans just aren’t built to transcribe dozens of numbers by hand reliably. If the error is in the last decimal place, it doesn’t mean much, but when a decimal point drifts or a negative sign is dropped, the results are often quite substantively important.</p> <li><p><strong>Failures to Update:</strong> We are constantly updating our code, and authors who hand transcribe their results often update their code and forget to update all of their results, leaving old results in their paper.</p> </ul> <p>So, how do you avoid this problem? Use tools that will directly export your results into plain text or formatted tables you can use in the program where you are working. For example, <code class="docutils literal notranslate"><span class=pre >statsmodels</span></code> in Python <a class="reference external" href="https://www.statsmodels.org/stable/generated/statsmodels.iolib.table.SimpleTable.html#statsmodels.iolib.table.SimpleTable">can export regression tables to lots of formats</a>, <a class="reference external" href="https://www.rdocumentation.org/packages/stargazer/versions/5.2.2/topics/stargazer">R has stargazer</a>, and Stata has <a class="reference external" href="http://repec.org/bocode/e/estout/esttab.html">estout</a>.</p> <p>I also suggest users not only do this for tables - which is increasingly common - but also statistics that appear in text. For example, to put a single number into <span class="math notranslate nohighlight">\(\LaTeX\)</span>, you just generate the number you want to put in your paper, convert it to a string, and save it to disk as a <code class="docutils literal notranslate"><span class=pre >.tex</span></code> file (e.g. <code class="docutils literal notranslate"><span class=pre >exported_statistic.tex</span></code>). Then in your paper, simply add a <code class="docutils literal notranslate"><span class=pre >\input{exported_statistic.tex}</span></code>call, and LaTeX will insert the contents of that <code class="docutils literal notranslate"><span class=pre >.tex</span></code> file verbatim into your paper.</p> <p>For example, here’s a way to save a single number to put into LaTeX:</p> <div class="nbinput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[6]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre>
<span></span><span class=c1 ># Here's a number I want in a paper</span>
<span class=n >x</span> <span class=o >=</span> <span class=mi >1</span><span class=o >/</span><span class=mi >3</span>

<span class=c1 ># Format it...</span>
<span class=n >x</span> <span class=o >=</span> <span class=sa >f</span><span class=s1 >'</span><span class=si >{</span><span class=n >x</span><span class=si >:</span><span class=s1 >.2f</span><span class=si >}</span><span class=s1 >'</span>

<span class=c1 ># Now write to disk!</span>
<span class=kn >import</span> <span class=nn >os</span>
<span class=n >os</span><span class=o >.</span><span class=n >chdir</span><span class=p >(</span><span class=s1 >'/users/nick/desktop'</span><span class=p >)</span>
<span class=k >with</span> <span class=nb >open</span><span class=p >(</span><span class=s2 >"test_file.tex"</span><span class=p >,</span> <span class=s2 >"w"</span><span class=p >)</span> <span class=k >as</span> <span class=n >text_file</span><span class=p >:</span>
    <span class=n >text_file</span><span class=o >.</span><span class=n >write</span><span class=p >(</span><span class=n >x</span><span class=p >)</span>

<span class=c1 ># Now I'm gonna erase</span>
<span class=c1 ># the file so I don't clutter my desktop. :)</span>

<span class=n >os</span><span class=o >.</span><span class=n >remove</span><span class=p >(</span><span class=s1 >'test_file.tex'</span><span class=p >)</span>
</pre></div> </div> </div> <p>While this type of integration works best for LaTeX, it can still be accomplished with many other programs like Word. For example, most packages that generate<code class="docutils literal notranslate"><span class=pre >.tex</span></code> files that can be easily integrated into LaTeX also often have options to export to <code class="docutils literal notranslate"><span class=pre >.txt</span></code> or <code class="docutils literal notranslate"><span class=pre >.rtf</span></code> files that you can easily use in Word. These tools can be used to generate tables can either be (a) copied whole-cloth into Word by hand (minimizing the risk of mis-transcriptions that may occur when typing individual values), or (b) using Word’s <a class="reference external" href="https://support.office.com/en-us/article/Insert-an-object-in-Word-or-Outlook-8fc1ea53-0e01-4603-a4cf-98c49b6ea3f5">Link to Existing File</a> feature to connect your Word document to the output of your code in a way that ensures the Word doc loads the most recent version of the table every time Word is opened. Some great tips for combining R with Word <a class="reference external" href="http://stanford.edu/~ejdemyr/r-tutorials/tables-in-r/">can be found here</a>.</p> </section> <section id=Style-Matters > <h2 id=Style-Matters >Style Matters<a class=headerlink  href="#Style-Matters" title="Permalink to this headline">¶</a></h2> <p>Formatting isn’t just about aesthetics, it also makes it easier to read your code and thus recognize potential problems. Here are a few tips:</p> <ul class=simple > <li><p><strong>Use informative variable names.</strong> Don’t call something <code class="docutils literal notranslate"><span class=pre >var212</span></code> if you can call it <code class="docutils literal notranslate"><span class=pre >unemployment_percentage</span></code>. Informative names require more typing, but they make your code so much easier to read. Moreover, including units in your variables names (<code class="docutils literal notranslate"><span class=pre >percentage</span></code>, <code class="docutils literal notranslate"><span class=pre >km</span></code>, etc.) can also help avoid confusion.</p> <li><p><strong>Comment!</strong> Comments help in two ways. First, and most obviously, they make it easy to figure out what’s going on when you come back to code days, weeks, or months after it was originally written. And second, it forces you to think about what you’re doing in <em>substantive</em> terms (“This section calculates the share of people within each occupation who have college degrees”) rather than just in programming logic, which can help you catch <em>substantive</em> problems with code that may run without problems but will not actually generate the quantity of interest.</p> <li><p><strong>Use indentation.</strong> Indentation is a way of visually representing the logical structure of code – use it to your advantage!</p> <li><p><strong>Let your code breathe.</strong> In general, you should put a space between every operator in your code, and feel free to use empty lines. Space makes your code more readable, as illustrated in the following examples:</p> </ul> <div class="nbinput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[7]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre>
<span></span><span class=c1 ># Bad</span>
<span class=k >def</span> <span class=nf >foo</span><span class=p >(</span><span class=n >a</span><span class=p >,</span> <span class=n >b</span><span class=p >):</span>
    <span class=k >return</span> <span class=n >a</span><span class=o >/</span><span class=mi >12</span><span class=o >+</span><span class=n >b</span>

<span class=c1 ># Good</span>
<span class=k >def</span> <span class=nf >convert_feet_and_inches_to_inches</span><span class=p >(</span><span class=n >feet</span><span class=p >,</span> <span class=n >inches</span><span class=p >):</span>
    <span class=k >return</span> <span class=n >feet</span> <span class=o >/</span> <span class=mi >12</span> <span class=o >+</span> <span class=n >inches</span>
</pre></div> </div> </div> <p>You can find a great Python style <a class="reference external" href="https://docs.python-guide.org/writing/style/">guide here</a>. Also, be aware that Python style is generally guided by the “bible” of Python style, a document known as “PEP8” you’ll hear talked about everywhere. <a class="reference external" href="http://adv-r.had.co.nz/Style.html">A full style guide for R can be found here</a>, and a <a class="reference external" href="https://michaelshill.net/2015/07/31/in-stata-coding-style-is-the-essential/">Stata style guide can be found here</a>.</p> </section> <section id="Don’t-Duplicate-Information"> <h2 id="Don’t-Duplicate-Information">Don’t Duplicate Information<a class=headerlink  href="#Don’t-Duplicate-Information" title="Permalink to this headline">¶</a></h2> <p>Tricks to minimize the probability of errors often require a little more sophisticated programming, so they won’t be for everyone (tests, I feel, are more accessible to everyone). Nevertheless, here’s another valuable practice: <strong>Never replicate information.</strong></p> <p>Information should only be expressed once in a file. For example, say you want to drop observations from a dataset if a person’s income has ever dropped below 20,000. You <em>could</em> do this like this:</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[8]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre>
<span></span><span class=n >df</span> <span class=o >=</span> <span class=n >pd</span><span class=o >.</span><span class=n >DataFrame</span><span class=p >({</span><span class=s1 >'income_2019'</span><span class=p >:</span> <span class=p >[</span><span class=mi >10000</span><span class=p >,</span> <span class=mi >20000</span><span class=p >,</span> <span class=mi >30000</span><span class=p >,</span> <span class=mi >40000</span><span class=p >,</span> <span class=mi >50000</span><span class=p >],</span>
                   <span class=s1 >'income_2018'</span><span class=p >:</span> <span class=p >[</span><span class=mi >50000</span><span class=p >,</span> <span class=mi >40000</span><span class=p >,</span> <span class=mi >30000</span><span class=p >,</span> <span class=mi >20000</span><span class=p >,</span> <span class=mi >10000</span><span class=p >],</span>
                   <span class=s1 >'income_2017'</span><span class=p >:</span> <span class=p >[</span><span class=mi >50000</span><span class=p >,</span> <span class=mi >20000</span><span class=p >,</span> <span class=mi >30000</span><span class=p >,</span> <span class=mi >40000</span><span class=p >,</span> <span class=mi >50000</span><span class=p >]})</span>

<span class=n >df</span> <span class=o >=</span> <span class=n >df</span><span class=p >[(</span><span class=n >df</span><span class=p >[</span><span class=s1 >'income_2019'</span><span class=p >]</span> <span class=o >&lt;</span> <span class=mi >20000</span><span class=p >)</span> <span class=o >|</span>
        <span class=p >(</span><span class=n >df</span><span class=p >[</span><span class=s1 >'income_2018'</span><span class=p >]</span> <span class=o >&lt;</span> <span class=mi >20000</span><span class=p >)</span> <span class=o >|</span>
        <span class=p >(</span><span class=n >df</span><span class=p >[</span><span class=s1 >'income_2017'</span><span class=p >]</span> <span class=o >&lt;</span> <span class=mi >20000</span><span class=p >)]</span>

<span class=n >df</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[8]:
</pre></div> </div> <div class="output_area rendered_html docutils container"> <div> <style scoped=""> .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } </style> <table border=1  class=dataframe > <thead> <tr style="text-align: right;"> <th> <th>income_2019 <th>income_2018 <th>income_2017 <tr> <th>0 <td>10000 <td>50000 <td>50000 <tr> <th>4 <td>50000 <td>10000 <td>50000 </table> </div></div> </div> <p>And indeed, this would work. But suppose you decided to change that cutoff from 20,000 to 30,000. The way this is written, you’ve opened yourself up to the possibility that in trying to change these cutoffs, you may change two of these but forget the third (something especially likely if the uses of the cutoff aren’t all in exactly the same place in your code). A better way of expressing this that avoids this possibility is:</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[9]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre>
<span></span><span class=n >df</span> <span class=o >=</span> <span class=n >pd</span><span class=o >.</span><span class=n >DataFrame</span><span class=p >({</span><span class=s1 >'income_2019'</span><span class=p >:</span> <span class=p >[</span><span class=mi >10000</span><span class=p >,</span> <span class=mi >20000</span><span class=p >,</span> <span class=mi >30000</span><span class=p >,</span> <span class=mi >40000</span><span class=p >,</span> <span class=mi >50000</span><span class=p >],</span>
                   <span class=s1 >'income_2018'</span><span class=p >:</span> <span class=p >[</span><span class=mi >50000</span><span class=p >,</span> <span class=mi >40000</span><span class=p >,</span> <span class=mi >30000</span><span class=p >,</span> <span class=mi >20000</span><span class=p >,</span> <span class=mi >10000</span><span class=p >],</span>
                   <span class=s1 >'income_2017'</span><span class=p >:</span> <span class=p >[</span><span class=mi >50000</span><span class=p >,</span> <span class=mi >20000</span><span class=p >,</span> <span class=mi >30000</span><span class=p >,</span> <span class=mi >40000</span><span class=p >,</span> <span class=mi >50000</span><span class=p >]})</span>

<span class=n >income_threshold</span> <span class=o >=</span> <span class=mi >20000</span>

<span class=n >df</span> <span class=o >=</span> <span class=n >df</span><span class=p >[(</span><span class=n >df</span><span class=p >[</span><span class=s1 >'income_2019'</span><span class=p >]</span> <span class=o >&lt;</span> <span class=n >income_threshold</span><span class=p >)</span> <span class=o >|</span>
        <span class=p >(</span><span class=n >df</span><span class=p >[</span><span class=s1 >'income_2018'</span><span class=p >]</span> <span class=o >&lt;</span> <span class=n >income_threshold</span><span class=p >)</span> <span class=o >|</span>
        <span class=p >(</span><span class=n >df</span><span class=p >[</span><span class=s1 >'income_2017'</span><span class=p >]</span> <span class=o >&lt;</span> <span class=n >income_threshold</span><span class=p >)]</span>

<span class=n >df</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[9]:
</pre></div> </div> <div class="output_area rendered_html docutils container"> <div> <style scoped=""> .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } </style> <table border=1  class=dataframe > <thead> <tr style="text-align: right;"> <th> <th>income_2019 <th>income_2018 <th>income_2017 <tr> <th>0 <td>10000 <td>50000 <td>50000 <tr> <th>4 <td>50000 <td>10000 <td>50000 </table> </div></div> </div> <p>Written like this, if you ever decide to go back and change the common cutoff, you only have to make <em>in one place</em>, and there’s no way to make the change in some cases but forget others.</p> </section> <section id=Collaboration > <h2 id=Collaboration >Collaboration<a class=headerlink  href="#Collaboration" title="Permalink to this headline">¶</a></h2> <p>Until now, the focus of this piece has been on <em>individual</em> coding practices that minimize the risk of errors. But as social science becomes increasingly collaborative, we also need to think about how to avoid errors in collaborative projects. In my experience, the way most social scientists collaborate on code (myself included, historically) is to place their code in a shared folder (like Dropbox or Box) and have co-authors work on the same files. There are a number of problems with this strategy, however:</p> <ul class=simple > <li><p>Participants can ever be certain about the changes the other author has made. Changes may be obvious when an author adds a new file or large block of code, but if one participant makes a small change in an existing file, the other authors are unlikely to notice. If the other authors then write their code assuming the prior coding was still in place, problems can easily emerge.</p> <li><p>There is no clear mechanism for review built into the workflow. Edits occur silently, and immediately become part of the files used in a project.</p> </ul> <p>I am aware of three strategies for avoiding these types of problems:</p> <p>The first and most conservative solution to this is <strong>full replication</strong>, where each team member conducts the full analysis independently and members then compare results. If results match, authors can feel confident there are no problems in their code. But this strategy requires a massive duplication of effort – offsetting many of the benefits of working on teams – and requires both authors be <em>able</em> to conduct the entire analysis, which is not always the case.</p> <p>The second strategy is <strong>compartmentalization</strong>, in which each author is assigned responsibility for coding specific parts of the analysis. Author A, for example, may be responsible for importing, cleaning, and formatting data from an outside source while Author B is responsible for subsequent analysis. In this system, if Author B finds she need an additional variable for the analysis, she ask Author A to modify Author A’s code rather than making modifications herself. This ensures responsibility for each block of code is clearly delimited, and changes are unlikely to sneak into an Author’s code without their knowledge. In addition, authors can also then review one another’s code prior to project finalization. But there is no process for continuous review of code, and if Author A modifies a variable that later gets passed to Author B and somehow the communication about what is being passed from person to person break down… bad things can happen.</p> <p>The final strategy is to <strong>use version control</strong> (i.e. git and github), which is by far the most robust solution and the one most used by computer scientists, but also the one that requires the most upfront investment in learning a new skill.</p> <p>Version control does several things for preventing errors. First, as the name implies, it keeps track of <em>every</em> version of your code that has ever existed and makes it easy to go back to old versions. This service is often provided by services like Dropbox, it is much easier to review old versions and identifying differences between old and new versions in <code class="docutils literal notranslate"><span class=pre >git</span></code> than through a service like Dropbox, whose interface is sufficiently cumbersome and most of us never use it unless we accidentally delete an important file.</p> <p>But what really makes version control exceptional is that it makes it easy to (a) keep track of what differs between any two versions, and to (b) “propose” changes to code in a way that other authors can easily review before those changes are fully integrated. If Author A wants to modify code in version control, she first creates a “branch” – a kind of working version of the project. She then makes her changes on that branch and propose the branch be re-integrated into the main code. Version control is then able to present this proposed change in a very clear way, highlighting every change that the new branch would make to the code base to ensure no changes – no matter how small – go unnoticed. The author that made the proposed changes can then ask their co-author to review the changes before they are integrated into the code base. To illustrate, Figure 1 shows an example of what a simple proposed change to code looks like on <em>GitHub</em>, a popular site for managing <code class="docutils literal notranslate"><span class=pre >git</span></code> projects online:</p> <img alt=git_example1  src="_images/git_example1.png"/> <p>The Figure shows an example of a small proposed change to the code for a project on <em>GitHub</em>. Several aspects of the interface are worth noting. First, the interface displays <em>all</em> changes and the lines just above and below the changes across all documents in the project. This ensures no changes are overlooked. (Authors can click to “unfold” the code around a change if they need more context.) Second, the interface shows the prior contents of the project (on the left) and new content (on the right). In the upper pane, content has been changed, so old content is shown in red and new content in green. In the lower pane, new content has just been added, so simple grey space is shown on the left. Third, authors can easily comment (and discuss) individual lines of code, as shown here. (If you’ve somehow gotten to this page without learning git and github, just see the tutorial on <a class="reference internal" href=git_and_github.html ><span class=doc >that topic here</span></a>!</p> </section> <section id="When-Should-I-Write-Tests?"> <h2 id="When-Should-I-Write-Tests?">When Should I Write Tests?<a class=headerlink  href="#When-Should-I-Write-Tests?" title="Permalink to this headline">¶</a></h2> <p>The best way to get into writing tests is to think about how you check your data interactively to make stuff work. After a <code class="docutils literal notranslate"><span class=pre >merge</span></code> or a <code class="docutils literal notranslate"><span class=pre >groupby</span></code> command, most people pause to browse the data and/or watch the code step by step, or do a set of quick tabs or plots. But these are not systematic, and you generally only do them once (when you’re first writing the code).</p> <p>A great way to write tests is to think about what you’re looking for when you do these interactive tests and convert the logic of those interactive interrogations into systematic assert statements. That way they’ll be baked into your code, and will be executed every time your code runs!1</p> <ul class=simple > <li><p>After <code class="docutils literal notranslate"><span class=pre >merge</span></code>: No where are problems with data made more clear then in a merge. ALWAYS add tests after a merge! More on that below.</p> <li><p>After complicated manipulations: If you have to think more than a little about how to get Python or Pandas to do something, there’s a chance you missed something. Add a test or two to make sure you did it right! Personally, for example, I almost never use <code class="docutils literal notranslate"><span class=pre >groupby</span></code> commands without adding tests — it’s just not a natural way to think about things, so I know I may have screwed up (and often have!).</p> <li><p>Before dropping observations: Dropping observations masks problems. Before you drop variables, add a test to, say, count the number of observations you expect to drop.</p> </ul> <section id=Common-Test-Examples > <h3 id=Common-Test-Examples >Common Test Examples<a class=headerlink  href="#Common-Test-Examples" title="Permalink to this headline">¶</a></h3> <p>Test number of observations is right:</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[10]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre>
<span></span><span class=c1 ># We'll use `world` again:</span>

<span class=n >world</span><span class=o >.</span><span class=n >sample</span><span class=p >(</span><span class=mi >5</span><span class=p >)</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[10]:
</pre></div> </div> <div class="output_area rendered_html docutils container"> <div> <style scoped=""> .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } </style> <table border=1  class=dataframe > <thead> <tr style="text-align: right;"> <th> <th>country <th>region <th>gdppcap08 <th>polityIV <tr> <th>29 <td>Congo Kinshasa <td>Africa <td>321 <td>15.0 <tr> <th>55 <td>Haiti <td>S. America <td>1177 <td>8.0 <tr> <th>122 <td>Swaziland <td>Africa <td>4928 <td>1.0 <tr> <th>130 <td>Tunisia <td>Middle East <td>7996 <td>6.0 <tr> <th>23 <td>Chad <td>Africa <td>1455 <td>8.0 </table> </div></div> </div> <div class="nbinput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[11]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre>
<span></span><span class=k >assert</span> <span class=nb >len</span><span class=p >(</span><span class=n >world</span><span class=p >)</span> <span class=o >==</span> <span class=mi >145</span>
</pre></div> </div> </div> <p>Check var that should have no missing has no missing.</p> <div class="nbinput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[12]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre>
<span></span><span class=k >assert</span> <span class=n >pd</span><span class=o >.</span><span class=n >notnull</span><span class=p >(</span><span class=n >world</span><span class=p >[</span><span class=s1 >'country'</span><span class=p >])</span><span class=o >.</span><span class=n >all</span><span class=p >()</span>
</pre></div> </div> </div> <div class="nbinput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[13]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre>
<span></span><span class=c1 ># Or, the same test written with any instead of all</span>
<span class=k >assert</span> <span class=ow >not</span> <span class=n >pd</span><span class=o >.</span><span class=n >isnull</span><span class=p >(</span><span class=n >world</span><span class=p >[</span><span class=s1 >'country'</span><span class=p >])</span><span class=o >.</span><span class=n >any</span><span class=p >()</span>
</pre></div> </div> </div> <p>Check my unique identifier is actually unique.</p> <div class="nbinput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[14]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre>
<span></span><span class=k >assert</span> <span class=ow >not</span> <span class=n >world</span><span class=p >[</span><span class=s1 >'country'</span><span class=p >]</span><span class=o >.</span><span class=n >duplicated</span><span class=p >()</span><span class=o >.</span><span class=n >any</span><span class=p >()</span>
</pre></div> </div> </div> <p>Make sure values of GDP Per Capita have a reasonable value. Note this is a “reasonableness” test, not an absolute test. It’s possible this would fail and the data is ok, but this way if there’s a problem your attention will be flagged so you can check.</p> <div class="nbinput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[15]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre>
<span></span><span class=k >assert</span> <span class=p >((</span><span class=mi >100</span> <span class=o >&lt;</span> <span class=n >world</span><span class=o >.</span><span class=n >gdppcap08</span><span class=p >)</span> <span class=o >&amp;</span> <span class=p >(</span><span class=n >world</span><span class=o >.</span><span class=n >gdppcap08</span> <span class=o >&lt;</span> <span class=mi >100000</span><span class=p >))</span><span class=o >.</span><span class=n >all</span><span class=p >()</span>
</pre></div> </div> </div> </section> </section> </section> </article> </div> </div> </main> </div> <footer class=md-footer > <div class=md-footer-nav > <nav class="md-footer-nav__inner md-grid"> <a href=parquet.html  title=Parquet  class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel=prev > <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i> </div> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis > <span class=md-footer-nav__direction > Previous </span> Parquet </span> </div> </a> <a href=workflow.html  title="Workflow Management" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel=next > <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span class=md-flex__ellipsis > <span class=md-footer-nav__direction > Next </span> Workflow Management </span> </div> <div class="md-flex__cell md-flex__cell--shrink"><i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright > <div class=md-footer-copyright__highlight > &#169; Copyright 2021, Nick Eubank. </div> Created using <a href="http://www.sphinx-doc.org/">Sphinx</a> 4.1.2. and <a href="https://github.com/bashtage/sphinx-material/">Material for Sphinx</a> </div> </div> </div> </footer> <script src="_static/javascripts/application.js"></script> <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>